<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - NCR Management System</title>
    <link rel="stylesheet" href="../styles.css">
  </head>
  <body>
    <header role="banner">
      <div class="header-container">
        <img src="../assets/Crossfire Logo - no bkgd.png"
             alt="NCR Management System Logo"
             class="logo"
             draggable="false">

        <!-- Hamburger menu toggle -->
        <input type="checkbox" id="nav-toggle" class="nav-toggle" aria-label="Toggle navigation menu">
        <label for="nav-toggle" class="nav-toggle-label">
          <span class="hamburger"></span>
        </label>

        <nav role="navigation" aria-label="Main navigation" class="nav">
          <ul>
            <li><a href="index.html" aria-current="page">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="login.html" id="login-nav-link">Login</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <nav aria-label="Breadcrumb" class="breadcrumb">
      <ol>
        <li><span aria-current="page">Home</span></li>
      </ol>
    </nav>

    <main role="main">
      <h1>Non-Conformance Report Management</h1>

      <!-- ACTIONS / FILTERS -->
      <section class="actions-section" aria-labelledby="actions-heading">
        <h2 id="actions-heading" class="sr-only">NCR Actions</h2>

        <div class="search-section">
          <input type="checkbox"
                 id="search-toggle"
                 class="search-toggle"
                 aria-label="Toggle search section">
          <label for="search-toggle" class="search-toggle-label">
            <span class="search-toggle-text">Search Filters</span>
            <span class="search-toggle-icon" aria-hidden="true">▼</span>
          </label>

          <div class="search-content">
            <div class="search-columns">

              <!-- LEFT COLUMN: Supplier + Workflow Stage -->
              <div class="form-column">
                <!-- Supplier Filter (original) -->
                <label for="ncr-search" class="search-label">Supplier</label>
                <select id="ncr-search" name="ncr-search" aria-describedby="search-help">
                  <option value="">All Suppliers</option>
                </select>
                <p id="search-help" class="search-help">Filter NCR records by supplier</p>
              </div>
              <div class="form-column">
                <label for="workflow-filter" class="search-label">Workflow Stage</label>
                <select id="workflow-filter" name="workflow-filter" aria-describedby="workflow-help">
                  <option value="">All stages</option>
                  <option value="completed">Completed</option>
                  <option value="quality">Quality Inspector</option>
                  <option value="engineering">Engineering</option>
                </select>
                <p id="workflow-help" class="search-help">
                  Filter NCR records by the current workflow stage.
                </p>
              </div>

              <!-- RIGHT COLUMN: Active / Archived / All -->
              <div class="form-column">
                <div class="search-row end-align">
                  <input type="radio" id="search-active" name="ncr-active" value="active" checked>
                  <label for="search-active" class="search-label">Active records</label>
                </div>

                <div class="search-row end-align">
                  <input type="radio" id="search-archived" name="ncr-active" value="archived">
                  <label for="search-archived" class="search-label">Archived records</label>
                </div>

                <div class="search-row end-align">
                  <input type="radio" id="search-all" name="ncr-active" value="all">
                  <label for="search-all" class="search-label">All records</label>
                </div>

                <p id="status-help" class="status-help">
                  View active or archived NCR records
                </p>
              </div>

            </div>
          </div>
        </div>
      </section>

      <!-- NCR LIST -->
      <section class="ncr-list-section" aria-labelledby="ncr-list-heading">
        <div class="ncr-list-header">
          <h2 id="ncr-list-heading">NCR Records</h2>
          <div class="ncr-list-actions">
            <a href="create.html" class="btn btn-primary" role="button" id="create-ncr-btn">Create New NCR</a>
          </div>
        </div>

        <div class="table-container">
          <table class="ncr-table" role="table" aria-label="Non-Conformance Reports">
            <thead>
              <tr>
                <th scope="col">NCR Number</th>
                <th scope="col">Date Created</th>
                <th scope="col">Last Modified</th>
                <th scope="col">Supplier</th>
                <!-- NEW COLUMN: workflow / stage -->
                <th scope="col">Workflow Stage</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows injected by ncr-data.js -->
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <nav aria-label="NCR Records Pagination" class="pagination-nav">
          <div class="pagination-info">
            <span id="pagination-text" class="pagination-text">
              Showing <strong>1-5</strong> of <strong>0</strong> NCRs
            </span>
          </div>

          <div class="pagination-controls">
            <button type="button" class="pagination-btn pagination-btn-prev" disabled>
              <span aria-hidden="true">‹</span>
              <span class="pagination-btn-text">Previous</span>
            </button>

            <div class="pagination-pages"></div>

            <button type="button" class="pagination-btn pagination-btn-next">
              <span class="pagination-btn-text">Next</span>
              <span aria-hidden="true">›</span>
            </button>

            <div class="records-per-page-container">
              <select name="search-amount" id="search-amount" class="records-per-page-select">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15">15</option>
              </select>
            </div>
          </div>
        </nav>
      </section>

      <!-- ARCHIVE MODAL -->
      <div id="archive-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="archive-modal-title">Confirm Archive</h3>
          </div>
          <div class="modal-body">
            <p id="archive-modal-description">
              Are you sure you want to archive NCR
              <strong id="archive-ncr-number"></strong>?
            </p>
            <p class="modal-warning">
              You can restore the NCR from the archive within 90 days of deletion.
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" id="cancel-archive" class="btn btn-secondary">Cancel</button>
            <button type="button" id="confirm-archive" class="btn btn-danger">Archive</button>
          </div>
        </div>
      </div>

      <!-- UNARCHIVE MODAL -->
      <div id="unarchive-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="unarchive-modal-title">Confirm Un-archive</h3>
          </div>
          <div class="modal-body">
            <p>
              Are you sure you want to un-archive NCR
              <strong id="unarchive-ncr-number"></strong>?
            </p>
            <p class="modal-warning">
              This will make the NCR editable again.
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" id="cancel-unarchive" class="btn btn-secondary">Cancel</button>
            <button type="button" id="confirm-unarchive" class="btn btn-primary">Un-archive</button>
          </div>
        </div>
      </div>

      <!-- PDF VIEW MODAL -->
      <div id="pdf-view-overlay" class="pdf-view-overlay">
        <div class="pdf-view-container">
          <div class="pdf-view-header">
            <h2 id="pdf-view-title" class="pdf-view-title">Non-Conformance Report</h2>
            <button type="button" class="pdf-view-close" id="close-pdf-view">&times;</button>
          </div>
          <div class="pdf-view-body" id="pdf-view-content"></div>
          <div class="pdf-view-footer">
            <p>NCR Management System © 2025</p>
          </div>
        </div>
      </div>

    </main>

    <footer role="contentinfo" class="footer">
      <div>
        <p>&copy; 2025 NCR Management System. All rights reserved.</p>
      </div>
    </footer>

    <!-- PAGE SCRIPTS -->
    <script src="../code/ncr-data.js"></script>
    <script src="../code/pagination.js"></script>
    <script src="../code/credentials.js"></script>
    <script>
      // Control Create NCR button visibility based on user role
      document.addEventListener('DOMContentLoaded', function() {
        const createBtn = document.getElementById('create-ncr-btn');
        if (createBtn) {
          const credentials = getUserCredentials();
          if (!credentials || credentials.type !== 'Quality Inspector') {
            createBtn.style.display = 'none';
          }
        }
      });
    </script>
  </body>
</html>
